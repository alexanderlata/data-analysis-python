# 40 задач для изучения библиотеки pandas

## Примечания

- Все задачи предполагают создание файлов вручную или программно
- Каждая задача включает сохранение результатов в файл
- Рекомендуется выполнять задачи последовательно
- При создании файлов используйте реалистичные данные
- Проверяйте результаты с помощью `head()`, `info()`, `describe()`
- Обращайте внимание на типы данных и обрабатывайте ошибки

---

## Раздел 1: Основные структуры данных (Series, DataFrame, Index)

### Задача 1
Создайте объект `Series` из списка целых чисел от 1 до 15 и выведите его на экран. Дополнительно выведите:

a) Атрибуты `dtype`, `shape` и `index`  
b) Описательные статистики с помощью `describe()`  
c) Отдельно: среднее значение, медиану, стандартное отклонение, дисперсию  
d) Коэффициент асимметрии (skewness) с помощью метода `skew()`  
e) Коэффициент эксцесса (kurtosis) с помощью метода `kurt()`  
f) Преобразуйте Series в DataFrame с колонкой 'Число' и сохраните в файл `numbers.csv`

### Задача 2
Создайте объект `Series` из списка названий животных `['слон', 'тигр', 'лев', 'жираф', 'зебра', 'кенгуру']` и выведите его на экран с пользовательским индексом от 'A' до 'F'.

a) Преобразуйте в DataFrame с колонками 'Код' (индекс) и 'Животное' (значения)  
b) Добавьте колонку 'Длина_названия' с количеством символов в названии  
c) Сохраните результат в файл `animals.xlsx` на лист 'Животные'

### Задача 3
На основе словаря с оценками студентов создайте `Series`, где индекс — имя студента, значение — его балл:

```python
student_grades = {
    'Анна': 92,
    'Борис': 78,
    'Виктория': 85,
    'Григорий': 91,
    'Дарья': 73,
    'Евгений': 88
}
```

Выведите:

a) Созданный объект и его основные атрибуты  
b) Описательные статистики (`describe()`)  
c) Минимальную, максимальную оценку, среднее и медиану  
d) Квартили (25%, 50%, 75%)  
e) Коэффициенты асимметрии и эксцесса для распределения оценок  
f) Преобразуйте в DataFrame и сохраните в `student_grades.csv`

### Задача 4
Создайте CSV-файл вручную `countries_asia.csv` со следующими колонками:
- `Страна` - название страны
- `Столица` - название столицы
- `Население_млн` - численность населения в миллионах

Добавьте данные для 10 стран Азии. Затем:

a) Загрузите файл в DataFrame  
b) Выведите первые 5 строк  
c) Выведите информацию о типах данных (`info()`)  
d) Вычислите описательные статистики для населения  
e) Найдите страну с максимальным населением  
f) Добавьте столбец 'Плотность' (придуманная площадь на ваш выбор) и сохраните в `countries_asia_extended.xlsx`

### Задача 5
Создайте `DataFrame` из следующего словаря:

```python
employees_data = {
    'Имя': ['Алексей', 'Мария', 'Петр', 'Елена', 'Иван', 'Ольга'],
    'Город': ['Москва', 'Санкт-Петербург', 'Казань', 'Омск', 
              'Екатеринбург', 'Нижний Новгород'],
    'Возраст': [28, 34, 45, 29, 52, 31],
    'Зарплата': [75000, 85000, 95000, 70000, 120000, 78000]
}
```

a) Выведите DataFrame и информацию о типах данных (`dtypes`)  
b) Используя методы `head(4)` и `tail(3)`, выведите первые 4 и последние 3 строки  
c) Выберите столбец 'Возраст' тремя разными способами  
d) Используя `describe()`, выведите описательные статистики для числовых столбцов  
e) Вычислите для столбца 'Зарплата': среднее, медиану, стандартное отклонение  
f) Найдите коэффициенты асимметрии и эксцесса для столбцов 'Возраст' и 'Зарплата'  
g) Сохраните DataFrame в файл `employees_basic.csv` с разделителем `;`

### Задача 6
Создайте `DataFrame` с данными о продажах книг за неделю:

```python
books_data = {
    'Название': ['Война и мир', 'Преступление и наказание', 'Мастер и Маргарита', 
                 'Анна Каренина', 'Идиот', 'Отцы и дети', 'Евгений Онегин'],
    'Автор': ['Толстой', 'Достоевский', 'Булгаков', 'Толстой', 
              'Достоевский', 'Тургенев', 'Пушкин'],
    'Цена': [850, 620, 730, 900, 680, 540, 480],
    'Продано': [45, 67, 89, 34, 52, 41, 78]
}
```

a) Установите столбец 'Название' в качестве индекса  
b) Создайте новый столбец 'Выручка' = Цена × Продано  
c) Отсортируйте DataFrame по выручке в порядке убывания  
d) Выведите описательные статистики для столбцов 'Цена', 'Продано' и 'Выручка'  
e) Вычислите коэффициенты асимметрии и эксцесса для распределения выручки  
f) Найдите корреляцию между ценой и количеством проданных книг  
g) Сохраните в Excel-файл `books_sales.xlsx` на лист 'Продажи'

### Задача 7
Создайте `DataFrame` с временным индексом (DatetimeIndex) для температурных данных за две недели:

```python
import pandas as pd
import numpy as np

dates = pd.date_range('2024-01-01', periods=14, freq='D')
temperatures = np.random.randint(15, 30, size=14)
```

a) Создайте DataFrame с датами в качестве индекса и столбцом 'Температура'  
b) Добавьте столбец с названиями дней недели  
c) Выберите данные только за выходные дни  
d) Вычислите описательные статистики для температур  
e) Найдите среднюю температуру по дням недели  
f) Вычислите коэффициенты асимметрии и эксцесса для распределения температур  
g) Сохраните в файл `temperature_data.csv` с сохранением индекса

## Раздел 2: Загрузка и сохранение данных из различных источников

### Задача 8
Создайте CSV-файл вручную `employees_full.csv` со следующими колонками:
- `id` - уникальный номер сотрудника (числа от 1 до 10)
- `name` - имя сотрудника
- `department` - отдел (IT, HR, Sales, Finance)
- `salary` - зарплата (от 50000 до 150000)
- `experience_years` - опыт работы в годах (от 1 до 15)

Создайте минимум 10 записей. Затем:

a) Загрузите файл в DataFrame  
b) Выведите первые 5 строк  
c) Вызовите методы `info()` и `describe()`  
d) Найдите среднюю зарплату по отделам  
e) Сохраните результат группировки в новый файл `salary_by_department.xlsx`

### Задача 9
Создайте JSON-файл вручную `students.json` со следующей структурой для 8 студентов:

```json
[
  {
    "name": "Иван Петров",
    "age": 20,
    "gpa": 4.5,
    "faculty": "Информатика"
  },
  ...
]
```

a) Загрузите данные с помощью `pd.read_json()`  
b) Выведите информацию о DataFrame  
c) Найдите студента с максимальным GPA  
d) Добавьте столбец 'Статус' (GPA >= 4.0 → 'Отличник', иначе 'Хорошист')  
e) Сохраните обратно в JSON с параметром `orient='records'` и `indent=2`  
f) Дополнительно сохраните в CSV-файл `students.csv`

### Задача 10
Создайте два CSV-файла со следующей структурой:

**`sales_2023.csv`:**
- `date` - дата (формат YYYY-MM-DD, 50 дат 2023 года)
- `product` - товар (A, B, C)
- `amount` - сумма продажи
- `quantity` - количество

**`sales_2024.csv`:**
- Те же колонки, 50 дат 2024 года

Затем:

a) Загрузите оба файла с параметром `parse_dates=['date']`  
b) Объедините их вертикально с помощью `pd.concat()`  
c) Сбросьте индекс методом `reset_index(drop=True)`  
d) Вычислите общую сумму продаж по годам  
e) Найдите самый продаваемый товар по каждому году  
f) Сохраните объединенный DataFrame в `sales_2023_2024.xlsx` с двумя листами: 'Все данные' и 'Статистика по годам'

### Задача 11
Создайте Excel-файл вручную `products_inventory.xlsx` с двумя листами:

**Лист "Товары":**
- `Артикул` - код товара (A001-A010)
- `Наименование` - название
- `Категория` - категория товара
- `Цена` - цена

**Лист "Склад":**
- `Артикул` - код товара
- `Количество` - количество на складе
- `Поставщик` - название поставщика

Затем:

a) Загрузите оба листа в отдельные DataFrame  
b) Объедините их по артикулу с помощью `merge()`  
c) Создайте столбец 'Стоимость_на_складе' = Цена × Количество  
d) Найдите общую стоимость товаров по категориям  
e) Сохраните результат в Parquet-файл `inventory_analysis.parquet`  
f) Загрузите Parquet-файл обратно и убедитесь в корректности данных

### Задача 12
Загрузите CSV-файл с различными параметрами. Создайте файл `data_with_issues.csv` со следующей структурой:

```
# Комментарий
# Еще комментарий
id;name;value;date
1;Product A;100;2024-01-01
2;Product B;200;2024-01-02
...
```

a) Загрузите файл, пропустив первые 2 строки (`skiprows=2`)  
b) Укажите разделитель `;` (`sep=';'`)  
c) Загрузите только столбцы 'name' и 'value' (`usecols=['name', 'value']`)  
d) При загрузке задайте типы данных: `dtype={'value': float}`  
e) Добавьте новые данные и сохраните в стандартном CSV-формате (разделитель `,`)

## Раздел 3: Индексация, выбор и фильтрация данных

### Задача 13
Используя DataFrame с информацией о сотрудниках из Задачи 5:

a) Используя `loc[]`, выберите вторую, третью и четвертую строки и первые два столбца  
b) Используя `iloc[]`, выберите строки с индексами 1, 3, 5 и столбцы 0, 2  
c) Отфильтруйте DataFrame так, чтобы остались только сотрудники старше 30 лет с зарплатой выше 80000  
d) Выберите одновременно столбцы 'Имя', 'Город' и 'Зарплата', создав новый DataFrame  
e) Сохраните отфильтрованные данные в `employees_filtered.csv`

### Задача 14
Создайте CSV-файл `student_performance.csv` со следующими колонками для 12 студентов:
- `Студент` - имя
- `Математика` - оценка (0-100)
- `Физика` - оценка (0-100)
- `Химия` - оценка (0-100)
- `Литература` - оценка (0-100)
- `История` - оценка (0-100)

Затем:

a) Загрузите данные  
b) Создайте столбец 'Средний_балл'  
c) Выберите студентов со средним баллом выше 80  
d) Найдите студентов, у которых хотя бы по одному предмету оценка ниже 60  
e) Отсортируйте по среднему баллу в порядке убывания  
f) Выберите топ-3 студента по каждому предмету (используйте `nlargest()`)  
g) Сохраните итоговую таблицу с рейтингом в `student_rankings.xlsx`

### Задача 15
Создайте CSV-файл `movies.csv` со следующими колонками для 20 фильмов:
- `Название` - название фильма
- `Жанр` - жанр (драма, комедия, боевик, фантастика)
- `Год` - год выпуска (2010-2024)
- `Рейтинг` - рейтинг (5.0-10.0)
- `Сборы_млн` - кассовые сборы в миллионах

Затем:

a) Загрузите и выведите информацию о данных  
b) Отфильтруйте фильмы, выпущенные после 2015 года с рейтингом выше 7.5  
c) Выберите фильмы жанров 'драма' ИЛИ 'комедия' И со сборами более 100 млн  
d) Отсортируйте по году (убывание), затем по рейтингу (убывание)  
e) С помощью `sample(n=5, random_state=42)` выберите 5 случайных фильмов  
f) Используя `query()`, найдите фильмы: `Год > 2018 and Рейтинг > 8.0`  
g) Сохраните отфильтрованные результаты в `top_movies.csv`

### Задача 16
Работа со столбцами и строками. Создайте DataFrame:

```python
shop_data = {
    'Товар': ['Хлеб', 'Молоко', 'Яйца', 'Сыр', 'Масло'],
    'Цена': [45, 85, 120, 450, 230],
    'Количество': [50, 30, 100, 15, 20]
}
```

a) Добавьте столбцы: 'Стоимость' = Цена × Количество, 'НДС' = Стоимость × 0.20  
b) Переименуйте: 'Товар' → 'Наименование', 'Цена' → 'Цена_руб'  
c) Удалите столбец 'НДС'  
d) Добавьте новую строку с товаром 'Йогурт'  
e) Удалите строку с индексом 2  
f) Сохраните в `shop_inventory.xlsx` без индекса

### Задача 17
Используя DataFrame из Задачи 5 (загрузите из сохраненного файла):

a) Выберите сотрудников из Москвы ИЛИ Санкт-Петербурга И возрастом от 25 до 40 лет  
b) Используя `query()`, отфильтруйте: `Зарплата >= 70000 and Зарплата <= 90000`  
c) Создайте булеву маску для сотрудников с четным возрастом  
d) Используя `isin()`, выберите сотрудников из городов ['Москва', 'Казань', 'Омск']  
e) Добавьте столбец 'Год_рождения' = 2024 - Возраст  
f) Сохраните все варианты фильтрации в отдельные листы Excel-файла `employees_filtered_variants.xlsx`

## Раздел 4: Обработка пропущенных значений

### Задача 18
Создайте CSV-файл `health_data.csv` со следующими колонками для 10 пациентов:
- `Пациент` - ID пациента (П001-П010)
- `Возраст` - возраст (некоторые ячейки оставьте пустыми)
- `Вес` - вес в кг (некоторые ячейки оставьте пустыми)
- `Рост` - рост в см (некоторые ячейки оставьте пустыми)
- `Давление` - давление (некоторые ячейки оставьте пустыми)

Намеренно оставьте 3-4 пустых значения в разных столбцах. Затем:

a) Загрузите файл и используя `isnull()` и `notnull()`, выведите информацию о пропусках  
b) Подсчитайте количество пропусков в каждом столбце  
c) Найдите строки, содержащие хотя бы один пропуск  
d) Вычислите процент пропущенных значений для каждого столбца  
e) Создайте тепловую карту пропусков (может использовать визуализацию)

### Задача 19
Используя файл из предыдущей задачи, примените различные стратегии заполнения:

a) Заполните пропуски в 'Возраст' медианным значением  
b) Заполните пропуски в 'Вес' средним значением  
c) Заполните пропуски в 'Рост' методом forward fill (`method='ffill'`)  
d) Заполните пропуски в 'Давление' методом backward fill (`method='bfill'`)  
e) Создайте 4 отдельных DataFrame с разными стратегиями  
f) Сохраните результаты в один Excel-файл с листами: 'Median', 'Mean', 'Ffill', 'Bfill'  
g) Сравните описательные статистики до и после заполнения

### Задача 20
Создайте CSV-файл `sales_timeseries.csv` с колонками:
- `date` - 30 последовательных дат (2024-01-01 до 2024-01-30)
- `sales` - продажи, намеренно оставьте 5-7 пустых значений в разных местах

Затем:

a) Загрузите с установкой 'date' как индекс  
b) Заполните пропуски методом линейной интерполяции (`interpolate()`)  
c) Заполните пропуски скользящим средним с окном 3  
d) Сравните результаты интерполяции и скользящего среднего  
e) Удалите все строки с пропусками (`dropna()`) и посчитайте сколько строк осталось  
f) Сохраните три варианта в Excel: 'Original', 'Interpolated', 'Rolling_mean'

### Задача 21
Создайте CSV-файл `mixed_data.csv` со следующими колонками для 10 записей:
- `ID` - номер
- `Название` - текстовое поле (оставьте 2 пустыми)
- `Значение_1` - число (оставьте 3 пустыми)
- `Значение_2` - число (оставьте 3 пустыми)
- `Категория` - текстовая категория (X, Y, Z; оставьте 2 пустыми)

Затем:

a) Загрузите данные  
b) Удалите строки, где пропущено более 50% значений  
c) Заполните пропуски в 'Категория' самым частым значением (модой)  
d) Замените пропуски в числовых столбцах на -1  
e) Используйте `dropna(thresh=3)` для удаления строк с менее чем 3 значениями  
f) Сохраните очищенные данные в `mixed_data_cleaned.csv`

## Раздел 5: Преобразование и очистка данных

### Задача 22
Создайте CSV-файл `messy_data.csv` со следующими колонками для 8 записей:
- `Имя` - с лишними пробелами и разным регистром ('  Иван  ', 'МАРИЯ', 'пётр')
- `Email` - с разным регистром ('ivan@mail.ru', 'MARIA@GMAIL.COM')
- `Телефон` - в разных форматах ('+7(495)123-45-67', '8-926-234-56-78', '89161234567')
- `Зарплата` - с символами ('75000₽', '85 000', '95000 руб', '70000')

Затем:

a) Загрузите данные  
b) Очистите 'Имя' от пробелов и приведите к формату: первая буква заглавная  
c) Приведите email к нижнему регистру  
d) Стандартизируйте телефоны к формату +7XXXXXXXXXX (используйте регулярные выражения или замены)  
e) Преобразуйте 'Зарплата' в числовой формат  
f) Сохраните очищенные данные в `clean_data.csv`

### Задача 23
Создайте CSV-файл `products_categories.csv` со следующими колонками для 15 товаров:
- `Товар` - тип товара (Ноутбук, Телефон, Планшет, Наушники)
- `Бренд` - бренд (Apple, Samsung, Lenovo, Sony, JBL)
- `Статус` - состояние (new, used, refurbished)
- `Цена` - цена товара

Затем:

a) Загрузите данные  
b) Преобразуйте 'Товар' и 'Бренд' в категориальный тип (`astype('category')`)  
c) Используя `replace()`, замените: 'new'→'Новый', 'used'→'Б/У', 'refurbished'→'Восстановленный'  
d) Создайте dummy-переменные для 'Статус' с помощью `get_dummies()`  
e) Используя `map()`, создайте числовой код для каждого типа товара  
f) Сохраните результат в `products_encoded.xlsx` с двумя листами: 'Original' и 'Encoded'

### Задача 24
Создайте CSV-файл `data_types.csv` со следующими колонками:
- `Дата_строка` - даты в текстовом формате ('2024-01-15', '2024-02-20', ...)
- `Число_строка` - числа как текст ('1234', '5678', ...)
- `Булево_число` - 0 и 1
- `Цена_строка` - цены как текст ('1500.50', '2300.75', ...)

8 записей. Затем:

a) Загрузите данные и выведите типы (`dtypes`)  
b) Преобразуйте 'Дата_строка' в datetime  
c) Преобразуйте 'Число_строка' в int  
d) Преобразуйте 'Булево_число' в bool  
e) Преобразуйте 'Цена_строка' в float  
f) Выведите типы после преобразования  
g) Сохраните с правильными типами в `data_types_fixed.csv`

### Задача 25
Создайте CSV-файл `financial_transactions.csv` со следующими колонками для 60 записей:
- `Дата` - последовательные даты (2 месяца)
- `Категория` - категория расхода (Продукты, Транспорт, Развлечения, Одежда)
- `Сумма` - сумма расхода (500-5000)
- `Метод_оплаты` - метод (Карта, Наличные, Онлайн)

Затем:

a) Загрузите данные с преобразованием даты  
b) Используя `groupby(['Категория'])`, вычислите суммарные расходы  
c) Сгруппируйте по категории и методу оплаты, найдите средние значения  
d) Примените агрегацию с функциями: min, max, mean, sum, count  
e) Создайте сводную таблицу с категориями в строках и методами оплаты в столбцах  
f) Сохраните результаты группировки в `financial_summary.xlsx` с отдельными листами

### Задача 26
Создайте два CSV-файла:

**`departments.csv`:**
- `dept_id` - ID отдела (1, 2, 3, 4)
- `dept_name` - название (IT, HR, Финансы, Маркетинг)
- `manager` - имя менеджера

**`employees_dept.csv`:**
- `emp_id` - ID сотрудника (101-105)
- `name` - имя
- `dept_id` - ID отдела (1, 2, 1, 3, 5) - обратите внимание на 5!

Затем:

a) Загрузите оба файла  
b) Объедините используя `merge()` с параметром `how='inner'`  
c) Повторите с `how='left'`  
d) Повторите с `how='right'`  
e) Повторите с `how='outer'`  
f) Проанализируйте и опишите различия в результатах  
g) Сохраните все 4 варианта в `merge_results.xlsx` на отдельных листах

### Задача 27
Создайте три CSV-файла с продажами по кварталам:

**`sales_q1.csv`, `sales_q2.csv`, `sales_q3.csv`:**
- `date` - даты соответствующего квартала
- `product` - товар
- `amount` - сумма
- `quantity` - количество

По 30 записей в каждом. Затем:

a) Загрузите все три файла  
b) Объедините используя `pd.concat()` с `ignore_index=True`  
c) Добавьте столбец 'Квартал' перед объединением и объедините снова  
d) Создайте объединение с мультииндексом используя `keys=['Q1', 'Q2', 'Q3']`  
e) Вычислите статистику продаж по кварталам  
f) Сохраните в `sales_all_quarters.xlsx`

### Задача 28
Создайте CSV-файл `sales_long.csv` с колонками:
- `Дата` - месяц (2024-01, 2024-02, 2024-03, 2024-01, 2024-02, 2024-03)
- `Продукт` - товар (A, A, A, B, B, B)
- `Продажи` - значения продаж

6 записей минимум. Затем:

a) Загрузите данные  
b) Используя `pivot()`, преобразуйте так, чтобы продукты были в столбцах, даты в строках  
c) Создайте обратное преобразование с помощью `melt()`  
d) Используйте `pivot_table()` с агрегацией по среднему  
e) Добавьте еще один уровень данных и примените `stack()` и `unstack()`  
f) Сохраните результаты всех преобразований в `pivot_transformations.xlsx`

## Раздел 6: Вычисление и генерация новых признаков

### Задача 29
Создайте CSV-файл `stock_prices.csv` с колонками:
- `Дата` - 60 последовательных дат
- `Цена` - цена акции (случайные значения 100-200)

Затем:

a) Загрузите данные с датой как индекс  
b) Вычислите скользящее среднее (rolling mean) с окном 7 дней  
c) Вычислите скользящую медиану с окном 5 дней  
d) Вычислите скользящее стандартное отклонение с окном 7 дней  
e) Создайте столбец с процентным изменением по сравнению с предыдущим днем (`pct_change()`)  
f) Определите дни роста (цена выше скользящего среднего)  
g) Сохраните с добавленными столбцами в `stock_analysis.csv`

### Задача 30
Создайте CSV-файл `student_grades_detail.csv` со следующими колонками для 10 студентов:
- `Имя` - имя студента
- `Математика` - балл (0-100)
- `Физика` - балл (0-100)
- `Химия` - балл (0-100)
- `Литература` - балл (0-100)

Затем:

a) Загрузите данные  
b) Используя `apply()`, создайте столбец со средним баллом для каждого студента  
c) Используя `apply()` с axis=0, найдите максимальный балл по каждому предмету  
d) Создайте функцию для перевода баллов в оценки: A (90-100), B (80-89), C (70-79), D (60-69), F (<60)  
e) Примените эту функцию ко всем предметным столбцам  
f) Используя `applymap()`, округлите все числовые значения до целых  
g) Сохраните результат с оценками в `student_letter_grades.xlsx`

### Задача 31
Создайте CSV-файл `housing_data.csv` со следующими колонками для 15 квартир:
- `Площадь` - площадь в м²
- `Комнат` - количество комнат
- `Этаж` - этаж квартиры
- `Этажей_всего` - всего этажей в доме
- `Цена_млн` - цена в миллионах рублей

Затем:

a) Загрузите данные  
b) Создайте 'Цена_за_м2' = Цена_млн × 1000000 / Площадь  
c) Создайте 'Площадь_на_комнату' = Площадь / Комнат  
d) Создайте категориальный признак 'Тип_этажа': 'первый' (этаж = 1), 'последний' (этаж = этажей_всего), 'средний' (остальные)  
e) Создайте бинарный признак 'Большая_квартира' (площадь > 80)  
f) Нормализуйте 'Цена_за_м2' методом min-max scaling: (x - min) / (max - min)  
g) Сохраните с новыми признаками в `housing_features.csv`

### Задача 32
Создайте CSV-файл `product_reviews.csv` со следующими колонками для 10 отзывов:
- `ID` - номер отзыва
- `Отзыв` - текст отзыва (придумайте разные отзывы с восклицательными знаками и без)
- `Рейтинг` - оценка (1-5)

Затем:

a) Загрузите данные  
b) Создайте столбец 'Длина_отзыва' с количеством символов  
c) Создайте 'Количество_слов' - подсчет слов в отзыве  
d) Создайте бинарный признак 'Есть_восклицание' (наличие !)  
e) Извлеките первое слово каждого отзыва в столбец 'Первое_слово'  
f) Создайте признак 'Тональность' на основе ключевых слов (положительные: отличный, хороший, рекомендую; отрицательные: плохой, ужасный)  
g) Сохраните расширенные данные в `reviews_analyzed.xlsx`

### Задача 33
Создайте CSV-файл `weather_hourly.csv` со следующими колонками:
- `Дата_время` - datetime (100 записей каждые 6 часов, начиная с 2024-01-01 00:00)
- `Температура` - температура (15-30°C)
- `Влажность` - влажность (40-80%)

Затем:

a) Загрузите с преобразованием 'Дата_время' в datetime  
b) Извлеките: день недели, месяц, квартал, год в отдельные столбцы  
c) Создайте бинарный признак 'Выходной' (суббота/воскресенье = 1)  
d) Создайте категориальный 'Время_суток': 'утро' (6-12), 'день' (12-18), 'вечер' (18-24), 'ночь' (0-6)  
e) Вычислите количество дней с начала года для каждой записи  
f) Создайте признак 'Неделя_года' с помощью `.dt.isocalendar().week`  
g) Сохраните с временными признаками в `weather_features.xlsx`

### Задача 34
Создайте CSV-файл `website_analytics.csv` со следующими колонками для 15 пользователей:
- `Пользователь` - ID пользователя
- `Визиты` - количество визитов (5-50)
- `Просмотры_страниц` - общее количество просмотров (20-200)
- `Время_на_сайте` - время в секундах (100-1000)
- `Покупки` - количество покупок (0-10)

Затем:

a) Загрузите данные  
b) Создайте 'Страниц_за_визит' = Просмотры_страниц / Визиты  
c) Создайте 'Время_на_страницу' = Время_на_сайте / Просмотры_страниц  
d) Создайте 'Конверсия' = Покупки / Визиты × 100  
e) Создайте категории активности на основе квартилей числа визитов: 'низкая', 'средняя', 'высокая', 'очень_высокая'  
f) Вычислите z-score для каждого числового признака: (x - mean) / std  
g) Сохраните результат в `user_metrics.csv`

### Задача 35
Создайте CSV-файл `sales_regions.csv` со следующими колонками для 20 записей:
- `Регион` - регион (Москва, СПб, Казань)
- `Продукт` - продукт (A, B)
- `Квартал` - квартал (Q1, Q2)
- `Продажи` - сумма продаж
- `Количество` - количество единиц

Затем:

a) Загрузите данные  
b) Создайте сводную таблицу по регионам и продуктам с суммарными продажами  
c) Вычислите долю каждого региона в общих продажах (в процентах)  
d) Найдите топ-3 комбинации регион-продукт по продажам  
e) Создайте 'Средняя_цена' = Продажи / Количество  
f) Вычислите кумулятивную сумму продаж по каждому региону (`cumsum()`)  
g) Сохраните все результаты анализа в `regional_analysis.xlsx` с несколькими листами

## Раздел 7: Продвинутые операции и комплексный анализ

### Задача 36
Создайте CSV-файл `daily_sales.csv` со следующими колонками для 365 записей:
- `Дата` - последовательные даты за весь 2024 год
- `Продукт` - случайный выбор из ['A', 'B', 'C', 'D']
- `Регион` - случайный выбор из ['Север', 'Юг', 'Восток', 'Запад']
- `Продажи` - сумма продаж (1000-10000)
- `Расходы` - расходы (500-5000)

Затем:

a) Загрузите данные  
b) Создайте 'Прибыль' = Продажи - Расходы и 'Маржа' = Прибыль / Продажи × 100  
c) Найдите месяц с максимальными продажами для каждого продукта  
d) Вычислите скользящее среднее продаж за 30 дней  
e) Создайте сводную таблицу: регионы × продукты, показывающую среднюю маржу  
f) Определите сезонность: создайте столбец 'Сезон' и вычислите средние продажи по сезонам  
g) Сохраните полный анализ в `yearly_sales_analysis.xlsx`

### Задача 37
Создайте CSV-файл `hourly_data.csv` со следующими колонками:
- `Дата_время` - почасовые данные за 42 дня (1000+ записей)
- `Значение` - числовые значения (можно использовать cumsum случайных чисел)

Затем:

a) Загрузите с datetime индексом  
b) Преобразуйте почасовые данные в дневные используя `resample('D').mean()`  
c) Преобразуйте в недельные данные используя `resample('W').sum()`  
d) Вычислите процентное изменение по дням (`pct_change()`)  
e) Найдите локальные максимумы (дни, где значение больше предыдущего и следующего)  
f) Создайте столбец с трендом используя скользящее среднее за 7 дней  
g) Сохраните все агрегации в `timeseries_analysis.xlsx`

### Задача 38
Создайте CSV-файл `dirty_customer_data.csv` со следующими колонками для 10 записей:
- `ID` - с дубликатами (например: '001', '002', '003', '002', ...)
- `Имя` - с разным регистром и пробелами ('  Иван  ', 'МАРИЯ', 'Пётр', 'Мария', ...)
- `Возраст` - с ошибочными значениями ('25', '34', 'unknown', '34', ...)
- `Зарплата` - в разных форматах ('75000', 'error', '95k', '85000', ...)
- `Дата` - в разных форматах ('01.01.2020', '15-02-2020', '2020/03/10', 'invalid', ...)

Затем выполните полную очистку:

a) Загрузите данные  
b) Удалите дубликаты по ID, оставив первое вхождение  
c) Стандартизируйте имена (убрать пробелы, первая буква заглавная)  
d) Очистите 'Возраст': замените 'unknown' на NaN, преобразуйте в int  
e) Очистите 'Зарплата': удалите текст ('k', 'error'), преобразуйте в float  
f) Приведите даты к единому формату datetime, недопустимые замените на NaN  
g) Заполните все NaN подходящими методами (медиана для чисел, ffill для дат)  
h) Сохраните очищенные данные в `customer_data_clean.csv`

### Задача 39
Создайте CSV-файл `ecommerce_users.csv` со следующими колонками для 50 пользователей:
- `Пользователь_ID` - ID пользователя
- `Возраст` - возраст (18-65)
- `Количество_заказов` - количество заказов (1-50)
- `Средний_чек` - средняя сумма заказа (500-5000)
- `Дней_с_регистрации` - дней с регистрации (30-1000)
- `Отменённые_заказы` - количество отмененных (0-10)
- `Просмотры_без_покупки` - просмотры без покупок (0-100)

Затем выполните продвинутую аналитику:

a) Загрузите данные  
b) Создайте RFM-сегментацию:
   - R (Recency): группы по 'Дней_с_регистрации' (квартили)
   - F (Frequency): группы по 'Количество_заказов' (квартили)
   - M (Monetary): группы по 'Средний_чек' × 'Количество_заказов' (квартили)  
c) Вычислите LTV = Количество_заказов × Средний_чек  
d) Создайте 'Показатель_лояльности' = (Количество_заказов - Отменённые_заказы) / Количество_заказов  
e) Создайте 'Конверсия_просмотров' = Количество_заказов / (Количество_заказов + Просмотры_без_покупки)  
f) Создайте возрастные группы: '18-25', '26-35', '36-50', '50+'  
g) Вычислите средние метрики для каждой возрастной группы  
h) Определите сегменты пользователей на основе квантилей LTV  
i) Сохраните результат с сегментацией в `user_segmentation.xlsx`

### Задача 40
Итоговый комплексный проект. Создайте три связанных CSV-файла:

**`orders_data.csv`** (100 записей):
- `order_id` - ID заказа (1-100)
- `user_id` - ID пользователя (1-30)
- `order_date` - дата заказа (2023-2024)
- `total_amount` - общая сумма

**`users_data.csv`** (30 записей):
- `user_id` - ID пользователя (1-30)
- `name` - имя пользователя
- `registration_date` - дата регистрации (2022-2023)
- `city` - город (Москва, СПб, Казань, Новосибирск)

**`order_items_data.csv`** (300 записей):
- `order_id` - ID заказа (каждый заказ содержит 3 товара)
- `product_id` - ID товара (1-20)
- `quantity` - количество (1-5)
- `price` - цена за единицу

Затем выполните полный цикл анализа:

a) Загрузите все три файла  
b) Объедините все таблицы в один DataFrame используя `merge()`  
c) Вычислите метрики:
   - Общая выручка по городам
   - Средний чек по пользователям
   - Количество заказов по месяцам
   - Топ-10 самых популярных товаров (по количеству продаж)  
d) Создайте когортный анализ: сгруппируйте пользователей по месяцам регистрации и посчитайте метрики  
e) Вычислите retention rate: процент пользователей, сделавших повторную покупку в каждом месяце  
f) Найдите пользователей с аномальным поведением (очень большие или очень маленькие чеки) используя z-score  
g) Создайте сводную таблицу: города в строках, месяцы в столбцах, сумма продаж в значениях  
h) Постройте временной ряд продаж по дням с добавлением тренда (скользящее среднее)  
i) Создайте сводку по городам: количество пользователей, средний LTV, общая выручка  
j) Сохраните все результаты анализа в один Excel-файл `final_ecommerce_analysis.xlsx` с листами:
   - 'Raw_Data' - объединенные данные
   - 'City_Metrics' - метрики по городам
   - 'Monthly_Sales' - продажи по месяцам
   - 'Top_Products' - топ товары
   - 'Cohort_Analysis' - когортный анализ
   - 'Pivot_Table' - сводная таблица
   - 'User_Segments' - сегментация пользователей
